(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-my-login"],{"1bc1":function(e,t,n){"use strict";n.r(t);var i=n("293c"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=a.a},"293c":function(e,t,n){"use strict";(function(e,i){n("7a82");var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("d3b7"),n("ddb0"),n("e9c4");var o=a(n("c7eb")),u=a(n("1da1")),s=a(n("b85c")),r={data:function(){return{obj:null,time:0,isLoading:!1,isDownload:!1,keyValue:"",login:{key:null,keys:["",""],date:"",limit:""}}},onLoad:function(e){var t;this.isDownload=1==e.type;var n=uni.getStorageSync("ysin_login");if(n)this.login=n;else{var i=uni.getStorageSync("ysin_time_limit"),a=uni.getStorageSync("ysin_key"),o=uni.getStorageSync("ysin_date");this.login={key:a,keys:["",""],date:o,limit:i},this.setBackup()}this.keyValue=null!==(t=this.login.key)&&void 0!==t?t:""},methods:{checkKeys:function(){var e,t=!1,n=0,i=(0,s.default)(this.login.keys);try{for(i.s();!(e=i.n()).done;){var a=e.value;a&&(n++,a.length>15&&(t=!0))}}catch(o){i.e(o)}finally{i.f()}t||1==n?uni.showModal({title:"错误",content:"key1、key2必须同时小于15位或者为空",showCancel:!1}):this.isDownload?this.downLoad():this.upload(n)},downLoad:function(){var e=this;this.login.key?uni.showModal({title:"提示",content:"确定用云端数据覆盖本地数据？",success:function(t){t.confirm&&e.getBackupData()}}):this.getBackupData()},upload:function(e){var t=this;return(0,u.default)((0,o.default)().mark((function n(){var i,a;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.checkTime()){n.next=2;break}return n.abrupt("return");case 2:if(0==e){n.next=9;break}return n.next=5,t.checkBackupKeys(t.login.keys);case 5:if(i=n.sent,0==i){n.next=9;break}return uni.showModal({title:"错误",content:"key在数据库已经存在，无法使用..",showCancel:!1}),n.abrupt("return");case 9:a=t,uni.showModal({title:"说明",content:"目前只会上传收藏角色的数据（不包括预设列表）",confirmText:"确定",success:function(e){a.checkRes(e)}});case 11:case"end":return n.stop()}}),n)})))()},checkRes:function(t){var n=[];try{var i=uni.getStorageInfoSync();n=i.keys}catch(p){e.log(p)}var a={};if(t.confirm){var o,u=uni.getStorageSync("favObj"),r={},c=(0,s.default)(n);try{for(c.s();!(o=c.n()).done;){var l=o.value;if("ysin_login"==l||"ysin_profileData"==l){var d=uni.getStorageSync(l);a[l]=d}else if(u[l]&&u[l].isFav){var f=uni.getStorageSync(l);a[l]=f,r[l]=u[l]}}}catch(h){c.e(h)}finally{c.f()}a["favObj"]=r,this.comfirmUpload(a)}else t.cancel},comfirmUpload:function(e){if(e){uni.showLoading({title:"提交中..."});var t=JSON.stringify(e),n={data:t,keys:this.login.keys,key:this.login.key};this.login.key?this.updateBackupData(n):this.createBackpuData(n)}},checkTime:function(){var e=Date.now();return!(e-this.login.date>6e4)&&(uni.showToast({icon:"none",title:"服务器限制，1分钟内只能请求一次"}),!0)},getBackupData:function(){var e=this;return(0,u.default)((0,o.default)().mark((function t(){var n,a,u,s,r,c;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.checkTime()){t.next=2;break}return t.abrupt("return");case 2:if(n=e.keyValue,a=i.importObject("backup"),t.prev=4,!n){t.next=11;break}return t.next=8,a.getData(n);case 8:u=t.sent,t.next=14;break;case 11:return t.next=13,a.getDataByKeys(e.login.keys);case 13:u=t.sent;case 14:if(s=u.data[0],s){for(c in uni.showToast({title:"下载数据成功"}),r=JSON.parse(s.data),e.login.key=s._id,e.login.date=s.date,e.login.keys=s.key1?[s.key1,s.key2]:["",""],r)uni.setStorageSync(c,r[c]);e.setBackup(),uni.$emit("initData")}else uni.showToast({title:"未找到数据！"});t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](4),uni.showModal({title:"错误！",content:t.t0.errMsg,showCancel:!1});case 21:case"end":return t.stop()}}),t,null,[[4,18]])})))()},createBackpuData:function(e){var t=arguments,n=this;return(0,u.default)((0,o.default)().mark((function a(){var u,s,r;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return u=t.length>1&&void 0!==t[1]&&t[1],s=i.importObject("backup"),a.prev=2,a.next=5,s.createData(e);case 5:r=a.sent,uni.hideLoading(),u?uni.showModal({title:"提示",content:"云端数据过期，已重新上传（密钥重新生成）",showCancel:!1,confirmText:"知道了"}):uni.showToast({title:"上传数据成功"}),n.login.key=r.id,n.login.date=Date.now(),n.setBackup(),n.obj=null,a.next=18;break;case 14:a.prev=14,a.t0=a["catch"](2),uni.showToast({title:"上传数据失败"}),uni.hideLoading();case 18:case"end":return a.stop()}}),a,null,[[2,14]])})))()},updateBackupData:function(t){var n=this;return(0,u.default)((0,o.default)().mark((function a(){var u,s;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return u=i.importObject("backup"),a.prev=1,a.next=4,u.updateData(t);case 4:s=a.sent,s.updated>0?(n.obj=null,n.login.date=Date.now(),n.setBackup(),uni.hideLoading(),uni.showToast({title:"更新数据成功"})):n.createBackpuData(t,!0),a.next=13;break;case 8:a.prev=8,a.t0=a["catch"](1),uni.showToast({title:"更新数据失败"}),uni.hideLoading(),e.log(a.t0);case 13:case"end":return a.stop()}}),a,null,[[1,8]])})))()},checkBackupKeys:function(e){var t=this;return(0,u.default)((0,o.default)().mark((function n(){var a,u,s;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=i.importObject("backup"),n.prev=1,u={keys:e,key:t.login.key},n.next=5,a.checkKeys(u);case 5:return s=n.sent,n.abrupt("return",s.total);case 9:return n.prev=9,n.t0=n["catch"](1),uni.showToast({title:"错误"}),uni.hideLoading(),n.abrupt("return",1);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})))()},setBackup:function(){this.keyValue=this.login.key,this.login.limit=Date.now(),uni.setStorageSync("ysin_login",this.login),uni.$emit("updateLogin")},showAd:function(){this.isLoading||(this.time=Date.now(),this.$refs.adRewardedVideo.show())},onadload:function(e){this.isLoading=!1},onadclose:function(t){var n=t.detail;if(n&&n.isEnded){var i=Date.now();i-this.login.date>3e4&&(this.comfirmUpload(this.obj),e.log("onClose "+n.isEnded))}else this.obj=null,e.log("onClose "+n.isEnded)},onaderror:function(t){this.obj=null,e.log(t.detail),this.isLoading=!1}}};t.default=r}).call(this,n("5a52")["default"],n("a9ff")["default"])},"6ee6":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var i={uniPopup:n("b993").default,uniPopupDialog:n("b4f6").default,uniCard:n("3d92").default,uniSection:n("89d3").default,uniEasyinput:n("627c").default},a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("uni-popup",{ref:"inputDialog",attrs:{type:"dialog"}},[n("uni-popup-dialog",{ref:"inputClose",attrs:{mode:"input",value:e.keyValue,title:"输入密钥..",placeholder:"..."},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.confirm.apply(void 0,arguments)}}})],1),n("uni-card",{attrs:{spacing:"0",padding:"0"}},[n("uni-section",{attrs:{title:"一、密钥 ",rightText:"自动生成",type:"line"}}),n("v-uni-view",{staticStyle:{padding:"20px"}},[n("v-uni-view",[e._v("1、通过上传获得密钥，用下载数据")]),n("v-uni-view",[e._v("2、如果密钥和自定义key同时存在，则会通过密钥下载")]),n("v-uni-view",[e._v("3、清空密钥后，才会通过自定义key下载数据")]),n("v-uni-view",{staticStyle:{"margin-top":"20px"}},[n("uni-easyinput",{attrs:{disabled:!e.isDownload,placeholder:"密钥.."},model:{value:e.keyValue,callback:function(t){e.keyValue=t},expression:"keyValue"}})],1)],1)],1),n("uni-card",{attrs:{spacing:"0",padding:"0"}},[n("uni-section",{attrs:{title:"二、自定义Key",rightText:"非必须,但建议设置",type:"line"}}),n("v-uni-view",{staticStyle:{padding:"20px"}},[n("v-uni-view",[e._v("1、上传时，可以设置定义key（类似账号密码），用于下载数据")]),n("v-uni-view",[e._v("2、使用时需同时设置，且不大于15个字符，不需要清空即可，可以随时上传修改")]),n("v-uni-view",[e._v("3、建议用容易记住的文本，如QQ号+手机或者邮箱/生日，也可以用中文甚至符号，但是别用个人密码，因为这是明文存储的，并不安全")]),n("v-uni-view",{staticStyle:{"margin-top":"20px"}},[n("uni-easyinput",{attrs:{disabled:e.isDownload&&e.keyValue.length>0,placeholder:"Key1..."},model:{value:e.login.keys[0],callback:function(t){e.$set(e.login.keys,0,t)},expression:"login.keys[0]"}})],1),n("v-uni-view",{staticStyle:{"margin-top":"20px"}},[n("uni-easyinput",{attrs:{disabled:e.isDownload&&e.keyValue.length>0,placeholder:"Key2..."},model:{value:e.login.keys[1],callback:function(t){e.$set(e.login.keys,1,t)},expression:"login.keys[1]"}})],1)],1)],1),n("v-uni-button",{staticStyle:{margin:"40px 15px","background-color":"#f6f2ee"},attrs:{disabled:e.isLoading,loading:e.isLoading},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.checkKeys.apply(void 0,arguments)}}},[e._v(e._s(e.isDownload?"下载":"上传"))])],1)},o=[]},9506:function(e,t,n){"use strict";n.r(t);var i=n("6ee6"),a=n("1bc1");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var u=n("f0c5"),s=Object(u["a"])(a["default"],i["b"],i["c"],!1,null,"f87b44ca",null,!1,i["a"],void 0);t["default"]=s.exports}}]);