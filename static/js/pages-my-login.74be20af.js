(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-my-login"],{"1bc1":function(e,t,n){"use strict";n.r(t);var a=n("293c"),i=n.n(a);for(var u in a)["default"].indexOf(u)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(u);t["default"]=i.a},"293c":function(e,t,n){"use strict";(function(e,a){n("7a82");var i=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("d3b7"),n("ddb0"),n("e9c4");var u=i(n("c7eb")),r=i(n("1da1")),o=i(n("b85c")),c={data:function(){return{uploadType:0,servers:["快速上传"],obj:null,time:0,isLoading:!1,isDownload:!1,keyValue:"",login:{key:null,keys:["",""],date:"",limit:""}}},onLoad:function(e){var t;this.isDownload=1==e.type;var n=uni.getStorageSync("ysin_login");if(n)this.login=n;else{var a=uni.getStorageSync("ysin_time_limit"),i=uni.getStorageSync("ysin_key"),u=uni.getStorageSync("ysin_date");this.login={key:i,keys:["",""],date:u,limit:a},this.setBackup()}this.keyValue=null!==(t=this.login.key)&&void 0!==t?t:""},methods:{checkKeys:function(){var e,t=!1,n=0,a=(0,o.default)(this.login.keys);try{for(a.s();!(e=a.n()).done;){var i=e.value;i&&(n++,i.length>15&&(t=!0))}}catch(u){a.e(u)}finally{a.f()}t||1==n?uni.showModal({title:"错误",content:"key1、key2必须同时小于15位或者为空",showCancel:!1}):this.isDownload?this.downLoad():this.upload(n)},downLoad:function(){var e=this;this.login.key?uni.showModal({title:"提示",content:"确定用云端数据覆盖本地数据？",success:function(t){t.confirm&&e.getBackupData()}}):this.getBackupData()},upload:function(e){var t=this;return(0,r.default)((0,u.default)().mark((function n(){var a;return(0,u.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.checkTime()){n.next=2;break}return n.abrupt("return");case 2:a=t,"快速上传只会上传收藏角色的数据（不包括预设列表）",0==t.uploadType?uni.showModal({title:"说明",content:"快速上传只会上传收藏角色的数据（不包括预设列表）",success:function(t){t.confirm&&a.checkRes(e)}}):uni.showModal({title:"说明",content:"完整上传会上传所有本地缓存数据，但需要看一个激励视频，快速上传则不需要，可以在上方切换上传模式。",success:function(t){t.confirm&&a.checkRes(e)}});case 5:case"end":return n.stop()}}),n)})))()},checkRes:function(t){var n=this;return(0,r.default)((0,u.default)().mark((function a(){var i,r,c,s,l,d,f,p,k,h,v;return(0,u.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(0==t){a.next=7;break}return a.next=3,n.checkBackupKeys(n.login.keys);case 3:if(i=a.sent,0==i){a.next=7;break}return uni.showModal({title:"错误",content:"key在数据库已经存在，无法使用..",showCancel:!1}),a.abrupt("return");case 7:r=[];try{c=uni.getStorageInfoSync(),r=c.keys}catch(u){e.log(u)}if(s={},0==n.uploadType){l=uni.getStorageSync("favObj"),d={},f=(0,o.default)(r);try{for(f.s();!(p=f.n()).done;)k=p.value,"ysin_login"==k||"ysin_profileData"==k?(h=uni.getStorageSync(k),s[k]=h):l[k]&&l[k].isFav&&(v=uni.getStorageSync(k),s[k]=v,d[k]=l[k])}catch(y){f.e(y)}finally{f.f()}s["favObj"]=d,n.comfirmUpload(s)}case 11:case"end":return a.stop()}}),a)})))()},comfirmUpload:function(e){var t=arguments,n=this;return(0,r.default)((0,u.default)().mark((function a(){var i,r,o;return(0,u.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=t.length>1&&void 0!==t[1]&&t[1],!e){a.next=11;break}if(r=JSON.stringify(e),o={data:r,keys:n.login.keys,key:n.login.key,ad:i},!n.login.key){a.next=9;break}return a.next=7,n.updateBackupData(o);case 7:a.next=11;break;case 9:return a.next=11,n.createBackpuData(o);case 11:case"end":return a.stop()}}),a)})))()},checkTime:function(){var e=Date.now();return!(e-this.login.date>6e4)&&(uni.showToast({icon:"none",title:"服务器限制，1分钟内只能请求一次"}),!0)},getBackupData:function(){var e=this;return(0,r.default)((0,u.default)().mark((function t(){var n,i,r,o,c,s;return(0,u.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.checkTime()){t.next=2;break}return t.abrupt("return");case 2:if(n=e.keyValue,i=a.importObject("backup"),t.prev=4,!n){t.next=11;break}return t.next=8,i.getData(n);case 8:r=t.sent,t.next=14;break;case 11:return t.next=13,i.getDataByKeys(e.login.keys);case 13:r=t.sent;case 14:if(o=r.data[0],o){for(s in uni.showToast({title:"下载数据成功"}),c=JSON.parse(o.data),e.login.key=o._id,e.login.date=o.date,e.login.keys=o.key1?[o.key1,o.key2]:["",""],c)uni.setStorageSync(s,c[s]);e.setBackup(),uni.$emit("initData")}else uni.showToast({title:"未找到数据！"});t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](4),uni.showModal({title:"错误！",content:t.t0.errMsg,showCancel:!1});case 21:case"end":return t.stop()}}),t,null,[[4,18]])})))()},createBackpuData:function(e){var t=arguments,n=this;return(0,r.default)((0,u.default)().mark((function i(){var r,o,c;return(0,u.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return r=t.length>1&&void 0!==t[1]&&t[1],o=a.importObject("backup"),i.prev=2,i.next=5,o.createData(e);case 5:c=i.sent,uni.hideLoading(),r?uni.showModal({title:"提示",content:"云端数据过期，已重新上传（密钥重新生成）",showCancel:!1,confirmText:"知道了"}):uni.showToast({title:"上传数据成功"}),n.login.key=c.id,n.login.date=Date.now(),n.setBackup(),n.obj=null,i.next=18;break;case 14:i.prev=14,i.t0=i["catch"](2),uni.showToast({title:"上传数据失败"}),uni.hideLoading();case 18:case"end":return i.stop()}}),i,null,[[2,14]])})))()},createAdLog:function(t,n){var i=this;return(0,r.default)((0,u.default)().mark((function r(){var o,c;return(0,u.default)().wrap((function(u){while(1)switch(u.prev=u.next){case 0:return o={id:i.login.key,type:t,time:n,from:"login"},c=a.importObject("adLog",{customUI:!0}),u.prev=2,u.next=5,c.create(o);case 5:u.next=10;break;case 7:u.prev=7,u.t0=u["catch"](2),e.log(u.t0);case 10:case"end":return u.stop()}}),r,null,[[2,7]])})))()},updateBackupData:function(t){var n=this;return(0,r.default)((0,u.default)().mark((function i(){var r,o;return(0,u.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return r=a.importObject("backup"),i.prev=1,i.next=4,r.updateData(t);case 4:o=i.sent,o.updated>0?(n.obj=null,n.login.date=Date.now(),n.setBackup(),uni.hideLoading(),uni.showToast({title:"更新数据成功"})):n.createBackpuData(t,!0),i.next=13;break;case 8:i.prev=8,i.t0=i["catch"](1),uni.showToast({title:"更新数据失败"}),uni.hideLoading(),e.log(i.t0);case 13:case"end":return i.stop()}}),i,null,[[1,8]])})))()},checkBackupKeys:function(e){var t=this;return(0,r.default)((0,u.default)().mark((function n(){var i,r,o;return(0,u.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=a.importObject("backup"),n.prev=1,r={keys:e,key:t.login.key},n.next=5,i.checkKeys(r);case 5:return o=n.sent,n.abrupt("return",o.total);case 9:return n.prev=9,n.t0=n["catch"](1),uni.showToast({title:"错误"}),uni.hideLoading(),n.abrupt("return",1);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})))()},setBackup:function(){this.keyValue=this.login.key,this.login.limit=Date.now(),uni.setStorageSync("ysin_login",this.login),uni.$emit("updateLogin")},showAd:function(){this.isLoading||(this.time=Date.now(),this.$refs.adRewardedVideo.show())},onadload:function(e){this.isLoading=!1},onadclose:function(e){var t=this;return(0,r.default)((0,u.default)().mark((function n(){var a,i,r;return(0,u.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.detail,i=Date.now(),r=i-t.login.date,!a||!a.isEnded){n.next=10;break}return n.next=6,t.comfirmUpload(t.obj,!0);case 6:return n.next=8,t.createAdLog(1,r);case 8:n.next=13;break;case 10:return n.next=12,t.createAdLog(0,r);case 12:t.obj=null;case 13:case"end":return n.stop()}}),n)})))()},onaderror:function(t){this.obj=null,e.log(t.detail),this.isLoading=!1}}};t.default=c}).call(this,n("5a52")["default"],n("a9ff")["default"])},9506:function(e,t,n){"use strict";n.r(t);var a=n("eb74"),i=n("1bc1");for(var u in i)["default"].indexOf(u)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(u);var r=n("f0c5"),o=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,"19edf911",null,!1,a["a"],void 0);t["default"]=o.exports},eb74:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return a}));var a={uniPopup:n("b993").default,uniPopupDialog:n("b4f6").default,uniCard:n("3d92").default,uniSection:n("89d3").default,uniEasyinput:n("627c").default,uniListItem:n("6e18").default},i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("uni-popup",{ref:"inputDialog",attrs:{type:"dialog"}},[n("uni-popup-dialog",{ref:"inputClose",attrs:{mode:"input",value:e.keyValue,title:"输入密钥..",placeholder:"..."},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.confirm.apply(void 0,arguments)}}})],1),n("uni-card",{attrs:{spacing:"0",padding:"0"}},[n("uni-section",{attrs:{title:"密钥 ",type:"line"}}),n("v-uni-view",{staticStyle:{padding:"20px"}},[n("v-uni-view",[e._v("1、通过上传自动生成密钥，用于下载数据")]),n("v-uni-view",[e._v("2、如果密钥和自定义key同时存在，则会通过密钥下载")]),n("v-uni-view",[e._v("3、清空密钥后，才会通过自定义key下载数据")]),n("v-uni-view",{staticStyle:{"margin-top":"20px"}},[n("uni-easyinput",{attrs:{disabled:!e.isDownload,placeholder:"密钥.."},model:{value:e.keyValue,callback:function(t){e.keyValue=t},expression:"keyValue"}})],1)],1)],1),n("uni-card",{attrs:{spacing:"0",padding:"0"}},[n("uni-section",{attrs:{title:"自定义Key",type:"line"}}),n("v-uni-view",{staticStyle:{padding:"20px"}},[n("v-uni-view",[e._v("1、上传时，可以设置定义key（类似账户登录），用于下载数据")]),n("v-uni-view",[e._v("2、使用时需同时设置，且不大于15个字符，不需要清空即可，可以随时上传修改")]),n("v-uni-view",[e._v("3、建议用容易记住的文本，如UID、QQ、手机、邮箱，也可以用中文甚至符号，但是别用个人常用密码，因为这是明文存储的，并不安全")]),n("v-uni-view",{staticStyle:{"margin-top":"20px"}},[n("uni-easyinput",{attrs:{disabled:e.isDownload&&e.keyValue.length>0,placeholder:"Key1..."},model:{value:e.login.keys[0],callback:function(t){e.$set(e.login.keys,0,t)},expression:"login.keys[0]"}})],1),n("v-uni-view",{staticStyle:{"margin-top":"20px"}},[n("uni-easyinput",{attrs:{disabled:e.isDownload&&e.keyValue.length>0,placeholder:"Key2..."},model:{value:e.login.keys[1],callback:function(t){e.$set(e.login.keys,1,t)},expression:"login.keys[1]"}})],1)],1)],1),e.servers.length>1?n("uni-card",{attrs:{padding:"0",spacing:"0"}},[n("uni-section",{attrs:{title:"上传方式",type:"line"}}),n("v-uni-radio-group",[n("v-uni-view",{staticClass:"uni-list"},e._l(e.servers,(function(t,a){return n("uni-list-item",{key:a,attrs:{border:0!=a,title:t,clickable:!0},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.uploadType=a}},scopedSlots:e._u([{key:"footer",fn:function(){return[n("v-uni-radio",{attrs:{color:"#ad9388",checked:a==e.uploadType}})]},proxy:!0}],null,!0)})})),1)],1)],1):e._e(),n("v-uni-button",{staticStyle:{margin:"40px 15px","background-color":"#f6f2ee"},attrs:{disabled:e.isLoading,loading:e.isLoading},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.checkKeys.apply(void 0,arguments)}}},[e._v(e._s(e.isDownload?"下载":"上传"))])],1)},u=[]}}]);